<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>multiple touch test</title>
  <style type="text/css">
    .key.down {
      fill: #aae;
    }
  </style>
</head>

<body>
  <div class="touchArea"></div>
  <script type="text/javascript" charset="utf-8">
    var RADIUS = 180;
    var PADDING = 10;
    var SLICES = 12;
    var lineWidth = 30;
    var innerRadius = RADIUS - lineWidth;
    var svg = "";

    for (var i = 0; i < SLICES; i++) {
      var p1 = {
        x: Math.cos(Math.PI * 2 / SLICES * i) * RADIUS + RADIUS + PADDING,
        y: Math.sin(Math.PI * 2 / SLICES * i) * RADIUS + RADIUS + PADDING
      };

      var p2 = {
        x: Math.cos(Math.PI * 2 / SLICES * (i + 1)) * RADIUS + RADIUS + PADDING,
        y: Math.sin(Math.PI * 2 / SLICES * (i + 1)) * RADIUS + RADIUS + PADDING
      };

      var p4 = {
        x: Math.cos(Math.PI * 2 / SLICES * i) * innerRadius + RADIUS + PADDING,
        y: Math.sin(Math.PI * 2 / SLICES * i) * innerRadius + RADIUS + PADDING
      };

      var p3 = {
        x: Math.cos(Math.PI * 2 / SLICES * (i + 1)) * innerRadius + RADIUS + PADDING,
        y: Math.sin(Math.PI * 2 / SLICES * (i + 1)) * innerRadius + RADIUS + PADDING
      };


      //svg += "<path d='M " + (RADIUS + PADDING) + " " + (RADIUS + PADDING) + " L " + p3.x + " " + p3.y + " A " + innerRadius + " " + innerRadius + " 0 0 0 " + p4.x + " " + p4.y + " z' fill='green' stroke='white' onclick='alert(\"inner-" + i + "\")'/>";

      //svg += "<path d='M " + p1.x + " " + p1.y + " A " + RADIUS + " " + RADIUS + " 0 0 1 " + p2.x + " " + p2.y + "  L " + p3.x + " " + p3.y + " A " + RADIUS / 2 + " " + RADIUS / 2 + " 0 0 0 " + p4.x + " " + p4.y + "  z' fill='green' stroke='white' onclick='alert(\"outer-" + i + "\")'/>";
      svg += "<path d='M " + p1.x + " " + p1.y + " A " + RADIUS + " " + RADIUS + " 0 0 1 " + p2.x + " " + p2.y + "  L " + p3.x + " " + p3.y + " A " + innerRadius + " " + innerRadius + " 0 0 0 " + p4.x + " " + p4.y + "  z' fill='green' stroke='black' class='key' id='"+i+"'/>";


    }

    svg = "<svg height='" + (RADIUS * 2 + PADDING * 2) + "px' width='" + (RADIUS * 2 + PADDING * 2) + "px'>" + svg + "</svg>";

    document.querySelector('.touchArea').innerHTML = svg;
  </script>
  <script>
    var keys = [].slice.call(document.querySelectorAll('.key'), 0);
    var keyboard = document.querySelector('.touchArea');
    var touches = [];

    function isKey(key) {
      return keys.indexOf(key) >= 0;
    }

    function updateKeys() {
      keys.forEach(function(key) {
        key.classList.remove("down");
      });
      touches.forEach(function(touch) {
        if (isKey(touch.key))
          touch.key.classList.add("down");
      });
    }

    function getTouchIndex(id) {
      for (var i = 0; i < touches.length; i++) {
        if (touches[i].id === id) {
          return i;
        }
      }
      return -1;
    }

    function touchStart(evt) {
      evt.preventDefault();
      var changedTouches = evt.changedTouches;
      for (var i = 0; i < changedTouches.length; i++) {
        var key = changedTouches[i].target;
        touches.push({ id: changedTouches[i].identifier, key: key,ownID:key.id });
      }
      updateKeys();
    }

    function touchEnd(evt) {
      evt.preventDefault();
      var changedTouches = evt.changedTouches;
      for (var i = 0; i < changedTouches.length; i++) {
        var index = getTouchIndex(changedTouches[i].identifier);
        if (index >= 0) {
          touches.splice(index, 1);
        }
      }
      updateKeys();
    }

    function touchMove(evt) {
      evt.preventDefault();
      var changedTouches = evt.changedTouches;
      for (var i = 0; i < changedTouches.length; i++) {
        var touch = changedTouches[i];
        var index = getTouchIndex(touch.identifier);
        if (index >= 0) {
          var key = document.elementFromPoint(touch.pageX, touch.pageY);
          if (isKey(key)) {
            touches[index].key = key;
          }
        }
      }

      updateKeys();
    }

    keyboard.addEventListener("touchstart", touchStart, false);
    keyboard.addEventListener("touchmove", touchMove, false);
    keyboard.addEventListener("touchend", touchEnd, false);
  </script>
</body>

</html>